#!/usr/bin/env bash

if [[ -f $BUILD_DIR/environment.yml ]]; then
    puts-step 'Using Conda...'

    rm -fr /app/.heroku/python

    curl -O https://repo.continuum.io/miniconda/Miniconda3-latest-Linux-x86_64.sh
    bash Miniconda3-latest-Linux-x86_64.sh -b -p /app/.heroku/python

    rm -fr Miniconda3-latest-Linux-x86_64.sh

    if [[ ! -f requirements.txt ]]; then
        touch requirements.txt
    fi

    conda install nomkl -y
    conda env update -f environment.yml -n anaconda

    # SKIP_PIP_INSTALL=1
    # export SKIP_PIP_INSTALL
fi